{% extends request.htmx|yesno:"base_htmx.html,base.html" %}

{% load slippers %}
{% load humanize %}

{% block content %}

<div id="local-htmx-container">
    <div class="row my-2">
        <div class="col">
                {% for item in object_list %}
                <a role="button" hx-target="#local-htmx-container" hx-get="{% url 'bikes:stats_list' bike.slug item.id %}" class="btn btn-sm px-2 {% if item.id == component.pk %}btn-primary{% else %}btn-secondary{% endif %}">{{ item.name }}</a>
                {% endfor %}
        </div>
        <div class="col-2 text-end">
            {% url 'bikes:stats_create' bike.slug component.pk as url_create %}
            {% new_button url=url_create label='New Component' url=url_create target="stats-table-tbody" swap="afterbegin" width="100%" %}
        </div>
    </div>

    <div hx-trigger="reload from:body" hx-get="{% url 'bikes:stats_list' bike.slug component.pk %}" hx-target="#htmx-container">

        <div class="alert alert-info d-flex justify-content-between" role="alert">
            <div>{% for key, value in stats.items %}
                {{ key }}: {{ value|floatformat:0|intcomma }} km
                {% endfor %}</div>
            <div><strong>{{bike}}</strong> / {{component.name}}</div>
            <div> Total: {{ total|floatformat:0|intcomma }}km</div>
        </div>

        <table class="table table-striped table-bordered table-hover table-sm">
            <thead>
                <tr class="table-primary">
                    <th>Start date</th>
                    <th>End date</th>
                    <th class="w7">Price</th>
                    <th class="w10">Brand</th>
                    <th class="text-end w7">km</th>
                    <th class="text-end w6">Actions</th>
                </tr>
            </thead>
            <tbody class="table-group-divider" id="stats-table-tbody">
                {% for object in component_statistic %}
                {% include 'bikes/includes/partial_stats_row.html' %}
                {% empty %}
                <tr><td class="bg-warning text-center" colspan="6">No records</td></tr>
                {% endfor %}
            </tbody>
        </table>

    </div>
</div>

{% endblock content %}
